{"version":3,"file":"mappedchain.cjs.js","sources":["../src/get.ts","../src/mapper.ts","../src/mappedchain.ts","../src/chain.ts"],"sourcesContent":["const get = (object: any, path: Array<any> | String, value?: any) => {\n  if (!path) return undefined;\n  const pathArray = Array.isArray(path)\n    ? path\n    : path.split(/[,[\\].]/g).filter(Boolean);\n  return (\n    pathArray.reduce((prevObj, key) => prevObj && prevObj[key], object) || value\n  );\n};\n\nexport default get;\n","import get from \"./get\";\n\ninterface IMapper extends Function {\n  source: String;\n  type?: String;\n}\n\nconst mapperFactory = (raw: any, mapper: IMapper, opts?: object) => {\n  const aliases = {};\n  let mapped;\n\n  const alias = (prop: string) => {\n    return {\n      to: (key: string | Function) => {\n        aliases[prop] = key;\n      },\n    };\n  };\n\n  function getProp(property: string) {\n    let returnValue;\n\n    if (!property) {\n      return;\n    }\n\n    const key = aliases[property];\n\n    if (!key) {\n      return;\n    }\n\n    try {\n      returnValue =\n        typeof key === \"function\"\n          ? key.call(this, raw, property)\n          : get(raw, key, undefined);\n    } catch (e) {\n      console.error(e);\n      throw new Error(e);\n    }\n\n    return returnValue;\n  }\n\n  mapper(alias, raw);\n\n  mapped = Object.create(\n    {},\n    {\n      __isMapped__: {\n        enumerable: true,\n        get: () => true,\n        set: () => {},\n      },\n      __raw__: {\n        enumerable: true,\n        get: () => raw,\n      },\n      __source__: {\n        enumerable: true,\n        get: () => mapper.source,\n        set: () => {},\n      },\n    }\n  );\n\n  const props = Object.keys(aliases).reduce((prev, curr) => {\n    prev[curr] = {\n      get: getProp.bind(mapped, curr),\n      enumerable: true,\n    };\n\n    return prev;\n  }, {});\n\n  Object.defineProperties(mapped, props);\n  return mapped;\n};\n\nexport const create = (raw: object, mapper: IMapper, opts?: any) => {\n  let mapped;\n\n  if (raw === undefined) {\n    return null;\n  }\n\n  if (typeof mapper !== \"function\") {\n    return null;\n  }\n\n  if (!mapper.source) {\n    return null;\n  }\n\n  mapped = mapperFactory(raw, mapper, opts);\n\n  return mapped;\n};\n","export { default as get } from \"./get\";\nimport { create as createMapper } from \"./mapper\";\nexport { create } from \"./chain\";\n\nexport const mapper = {\n  create: createMapper,\n};\n","// const get = require('./get');\nimport get from \"./get\";\n\nconst chainFactory = (models) => {\n  const chain = {\n    models: () => [...models],\n    get: (prop, source, ...middleware) => {\n      let sortedModels;\n      let value;\n      const isSourceString = typeof source === \"string\";\n      const isSourceArray = Array.isArray(source);\n      const validMiddleware = middleware.filter((m) => typeof m === \"function\");\n\n      const runMiddleware = (initial) =>\n        validMiddleware.reduce((prev, curr) => curr(prev), initial);\n\n      if (typeof prop !== \"string\") {\n        return;\n      }\n\n      if (source !== undefined && !isSourceString && !isSourceArray) {\n        return;\n      }\n\n      if (isSourceString) {\n        const model = models.find((model) => model.__source__ === source);\n        if (!model) {\n          return;\n        }\n\n        return runMiddleware(get(model, prop));\n      }\n\n      if (isSourceArray) {\n        sortedModels = source.map((src) =>\n          models.find((model) => model.__source__ === src)\n        );\n      }\n\n      if (!sortedModels) {\n        sortedModels = models;\n      }\n\n      sortedModels.some((model) => {\n        value = get(model, prop);\n        return value !== undefined;\n      });\n\n      return runMiddleware(value);\n    },\n  };\n  return chain;\n};\n\nexport const create = (...mappedObjs) => {\n  const sources = [];\n  const isValid = mappedObjs.every((obj) => {\n    const isMapped = obj.__isMapped__;\n    const src = obj.__source__;\n    const isDifferent = sources.indexOf(obj.__source__) === -1;\n\n    sources.push(src);\n\n    return isMapped && isDifferent;\n  });\n\n  if (!isValid) {\n    return null;\n  }\n\n  const chain = chainFactory(mappedObjs);\n\n  return chain;\n};\n"],"names":["get","object","path","value","Array","isArray","split","filter","Boolean","reduce","prevObj","key","mapperFactory","raw","mapper","opts","aliases","mapped","getProp","property","returnValue","call","this","undefined","e","console","error","Error","prop","to","Object","create","__isMapped__","enumerable","set","__raw__","__source__","source","props","keys","prev","curr","bind","defineProperties","mappedObjs","sources","every","obj","isMapped","src","isDifferent","indexOf","push","models","middleware","sortedModels","isSourceString","isSourceArray","validMiddleware","m","runMiddleware","initial","model","find","map","some"],"mappings":"AAAA,MAAMA,EAAM,CAACC,EAAaC,EAA2BC,QAC9CD,SACaE,MAAMC,QAAQH,GAC5BA,EACAA,EAAKI,MAAM,YAAYC,OAAOC,UAEtBC,OAAO,CAACC,EAASC,IAAQD,GAAWA,EAAQC,GAAMV,IAAWE,GCCrES,EAAgB,CAACC,EAAUC,EAAiBC,WAC1CC,EAAU,OACZC,WAUKC,EAAQC,OACXC,MAECD,eAICR,EAAMK,EAAQG,MAEfR,OAKHS,EACiB,mBAART,EACHA,EAAIU,KAAKC,KAAMT,EAAKM,GACpBnB,EAAIa,EAAKF,OAAKY,GACpB,MAAOC,SACPC,QAAQC,MAAMF,GACR,IAAIG,MAAMH,UAGXJ,GAGTN,EAlCec,IACN,CACLC,GAAKlB,IACHK,EAAQY,GAAQjB,KA+BRE,GAEdI,EAASa,OAAOC,OACd,GACA,CACEC,EAAc,CACZC,YAAY,EACZjC,IAAK,KAAM,EACXkC,IAAK,QAEPC,EAAS,CACPF,YAAY,EACZjC,IAAK,IAAMa,GAEbuB,EAAY,CACVH,YAAY,EACZjC,IAAK,IAAMc,EAAOuB,OAClBH,IAAK,gBAKLI,EAAQR,OAAOS,KAAKvB,GAASP,OAAO,CAAC+B,EAAMC,KAC/CD,EAAKC,GAAQ,CACXzC,IAAKkB,EAAQwB,KAAKzB,EAAQwB,GAC1BR,YAAY,GAGPO,GACN,WAEHV,OAAOa,iBAAiB1B,EAAQqB,GACzBrB,GCzEIH,EAAS,CACpBiB,OD2EoB,CAAClB,EAAaC,EAAiBC,SAC/CE,cAEQM,IAARV,GAIkB,mBAAXC,EAHF,KAOJA,EAAOuB,QAIZpB,EAASL,EAAcC,EAAKC,GAErBG,GALE,sBEtCW,IAAI2B,WAClBC,EAAU,UACAD,EAAWE,MAAOC,UAC1BC,EAAWD,EAAIf,EACfiB,EAAMF,EAAIX,EACVc,GAAmD,IAArCL,EAAQM,QAAQJ,EAAIX,UAExCS,EAAQO,KAAKH,GAEND,GAAYE,KA5DDG,EAmEOT,EAlEb,CACZS,OAAQ,IAAM,IAAIA,GAClBrD,IAAK,CAAC4B,EAAMS,KAAWiB,SACjBC,EACApD,QACEqD,EAAmC,iBAAXnB,EACxBoB,EAAgBrD,MAAMC,QAAQgC,GAC9BqB,EAAkBJ,EAAW/C,OAAQoD,GAAmB,mBAANA,GAElDC,EAAiBC,GACrBH,EAAgBjD,OAAO,CAAC+B,EAAMC,IAASA,EAAKD,GAAOqB,MAEjC,iBAATjC,SAIIL,IAAXc,GAAyBmB,GAAmBC,OAI5CD,EAAgB,OACZM,EAAQT,EAAOU,KAAMD,GAAUA,EAAM1B,IAAeC,OACrDyB,gBAIEF,EAAc5D,EAAI8D,EAAOlC,WAG9B6B,IACFF,EAAelB,EAAO2B,IAAKf,GACzBI,EAAOU,KAAMD,GAAUA,EAAM1B,IAAea,KAI3CM,IACHA,EAAeF,GAGjBE,EAAaU,KAAMH,IACjB3D,EAAQH,EAAI8D,EAAOlC,QACFL,IAAVpB,IAGFyD,EAAczD,OAmBhB,KAhEWkD,IAAAA"}